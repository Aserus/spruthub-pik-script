# Скрипт для добавления домофонов и счетчиков воды от компании ПИК в Спрутхаб.

### Что есть
* Открытие домофонов
* Получение показаний счетчиков ХСВ и ГСВ
### Что в планах
* Добавление камер домофонов в спурт(сам спрутхаб пока что не поддерживает)
### Инструкция
* Открываем раздел Настройки  Сченарии  Глобальные 
* Создаем новый скрипт и называем его PIK
* Копируем в него содержимое файла main.js
* Заполняем телефон и пароль. Формат телефоан +79123456789
```js
const ACCOUNT_PHONE = "+79123456789"    
const ACCOUNT_PASSWORD = "12345678"
```
* Сохраняем скрипт
* Открываем консоль(справа снизу есть картинка жука - жмем на него) 
* Через несколько секунд в консоле должно отобразится сообщение
```
Скачайте логи на компьютер откройте и скопируйте из секции //--- КОНСТАНТЫ
```
* Скачайте логи на компьютер
* Распакуйте архив и откройте блокнотом stdout.log
* Найдите подобную секцию в самом конце и скопируйте его себе в начале файла(заменив то что у вас было)
```js
//--------------- КОНСТАНТЫ НАЧАЛО
const ACCOUNT_PHONE = ""
const ACCOUNT_PASSWORD = ""

//При наличии
const TOKEN = "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"
const DEVICE_UID = "XXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX"

const ASSOC_INTERCOM = {
	"УДОБНОЕ_НАЗВАНИЕ_1" : 12345,	// Калитка 2 // ВП.1.1.1 (Калитка)
	"УДОБНОЕ_НАЗВАНИЕ_2" : 12346,	// Калитка 1 //  (Калитка №2)ТД 1.1.1
	"УДОБНОЕ_НАЗВАНИЕ_3" : 12347,	// Подъезд // ВП1.1.1 (Подъезд)
}
const ASSOC_METERS = {
	"234567" : { aid: 0, cid:0 },	// Счетчик ХВС // 
	"345678" : { aid: 0, cid:0 },	// Счетчик ГВС // 
}
//--------------- КОНСТАНТЫ КОНЕЦ
```
* Сохраните

### Домофоны
* Создаем аксессуар и называем ПИК Домофоны
* Внутри него создаем необходимое количество сервисов. Тип "Выключатель", название это имя двери(Какое удобно будет)
* Создаем сценарий(смотри скриншот ниже)

![alt text](https://github.com/Aserus/spruthub-pik-script/blob/main/assets/screen1.png?raw=true)
![alt text](https://github.com/Aserus/spruthub-pik-script/blob/main/assets/screen2.png?raw=true)

Сценарий на открытие двери

![alt text](https://github.com/Aserus/spruthub-pik-script/blob/main/assets/screen3.png?raw=true)

### Счетчики воды
* Создаем аксессуар и называем ПИК Счетчики
* Внутри него создаем необходимое количество сервисов. Тип "Счетчик воды", название этого счетчика(Какое удобно будет)

![alt text](https://github.com/Aserus/spruthub-pik-script/blob/main/assets/screen4.png?raw=true)

Чтобы подгружались показания нужно заполнить ID аксессуара и ID характеристики в скрипте в переменной ASSOC_METERS
```js
const ASSOC_METERS = {
	"234567" : { aid: ID_АКСЕССУАРА, cid:ID_ХАРАКТЕРИСТИКИ },	// Счетчик ХВС // 
  ...
}
```
Посмотреть эти id можно на странице http://spruthub.local:55555/accessories

![alt text](https://github.com/Aserus/spruthub-pik-script/blob/main/assets/screen5.png?raw=true)



